<!doctype html>
<html>
    <head>
        <title>Consciousness of the Visual Surround</title>
		
		
		<!-- Import jsPsych plugins and libraries -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="../static/jspsych-4.3/jspsych.js"></script>
        <script src="../static/jspsych-4.3/plugins/jspsych-text.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-fixation-stim.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-cue-stim.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-cue4noclear-stim.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-circle-stim.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-circlenoclear-stim.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-single-stim.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-multi-stim-multi-response.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-quadruple-stim.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-similarity.js"></script>
		<script src="../static/jspsych-4.3/plugins/jspsych-survey-text.js"></script>
        <script src="../static/lib/underscore-min.js" type="text/javascript"></script>
        <script src="../static/lib/backbone-min.js" type="text/javascript"></script>
		<script src="../static/lib/bootstrap-min.js" type="text/javascript"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/black-tie/jquery-ui.min.css" rel="stylesheet" type="text/css"></link>
        <link href="../static/jspsych-4.3/css/jspsych.css" rel="stylesheet" type="text/css"></link>
		
		
		<!-- These variables are necessary to implement psiTurk -->
        <script type="text/javascript">
            // These fields provided by the psiTurk Server
            var uniqueId = "{{ uniqueId }}"; // a unique string identifying the worker/task
            var adServerLoc = "{{ adServerLoc }}"; // the location of your ad (so you can send user back at end of experiment)
            var mode = "{{ mode }}"; // is this running live, sandbox, or in debug mode?
        </script>
			
		
        <!-- utils.js and psiturk.js provide the basic psiturk functionality 
        <script src="../static/js/utils.js" type="text/javascript"></script>
		<script src="../static/js/psiturk.js" type="text/javascript"></script> -->

		
		<!-- Import Snag SVG for visual-search-circle -->
		<script src="../static/Snap.svg-0.4.1/dist/snap.svg-min.js"></script>
		
		
		<!-- Import css file -->
        <link type="text/css" rel="stylesheet" href="../static/js/jspsych-4.3/css/stylesheet.css"/>
		
		
		<!-- Import tasks -->
		<script src="../static/tasks/draw_fixation.js"></script>
		<script src="../static/tasks/draw_cue.js"></script>
		<script src="../static/tasks/shuffleArray.js"></script>
		
		
		<!-- Import css file -->
        <!-- <link type="text/css" rel="stylesheet" href="stylesheet.css"/>-->
		
		<style>
                body { overflow:hidden; };
        </style>
    </head>
    <body>
		<div id='jspsych-target' style='width:auto; height:auto; margin:auto;'></div>
		<div id='stimuli-target' style='width:auto; height:auto; margin:5% auto;'></div>
		<div id='vert-center' class="block center" style='width:auto; height:auto; margin:10% auto;'></div>
		<div id='photo-target' style='width:800; height:800; margin-top:-100px'></div>
		<!-- Marign should go top, right, bottom left. But double-check! -->
		<canvas class = "canvas" id="cueCanvas"></canvas>
    </body>
    <script> 
	
	//Create the variable for the file name to save the data (will need to increment this later on)
	var filename = "filename.csv";
	
    /* load psiturk! */
    //var psiturk = new PsiTurk(uniqueId, adServerLoc, mode);
	
	//COULD ADD BROWSER EXCLUSION CODE HERE.  THE STUFF WE HAVE DOESN'T WORK WITH THIS FILE . . . 
	/* Jason's browser exclusion code so subjects only use Google Chrome */
	function getBrowserInfo() 
		{ 
       	 	var ua = navigator.userAgent, tem, 
        	M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || []; 
        	if(/trident/i.test(M[1])) 
        	{ 
                tem=  /\brv[ :]+(\d+)/g.exec(ua) || []; 
                return 'IE '+(tem[1] || ''); 
        	} 
        	if(M[1]=== 'Chrome') 
        	{ 
                tem= ua.match(/\b(OPR|Edge)\/(\d+)/); 
                if(tem!= null) return tem.slice(1).join(' ').replace('OPR', 'Opera'); 
        	} 
        	M = M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?']; 
        	if((tem= ua.match(/version\/(\d+)/i))!= null) 
                M.splice(1, 1, tem[1]); 
        	return { 'browser': M[0], 'version': M[1] }; 
	} 

	var browserInfo = getBrowserInfo(); 
	if (browserInfo.browser !== 'Chrome') { 
		var wrong_browser = { 
	                type: 'text', 
	                text: '<p>This experiment only has support for Google Chrome.</p>' 
	                         +'<p>Please reopen the experiment in Google Chrome.</p>' 
	        }; 
	        jsPsych.init({ 
	                experiment_structure: [wrong_browser] 
	        }); 
	} else {  //This open bracket gets closed at the very end of the file!*/
	  

	
		//Stimulus parameters
		var circle_diameter = 400;
		var target_size = 125;
		var cue_size = 8;
	
		//Initialize the canvas
		var canvas = document.getElementById("cueCanvas");
		var cueContext = cueCanvas.getContext("2d");
		cueContext.canvas.width = circle_diameter + target_size;
		cueContext.canvas.height = circle_diameter + target_size;


		///// GENERAL FUNCTIONS YOU NEED FOR THIS EXPERIMENT (COULD MOVE THESE TO SEPARATE FILES AND CALL @ START) ////////
	
		//Function for shuffling an array and taking a subset of the elements
		//From here: http://stackoverflow.com/questions/11935175/sampling-a-random-subset-from-an-array/11935263
		function getRandomSubarray(arr, size) {
		    var shuffled = arr.slice(0), i = arr.length, temp, index;
		    while (i--) {
		        index = Math.floor((i + 1) * Math.random());
		        temp = shuffled[index];
		        shuffled[index] = shuffled[i];
		        shuffled[i] = temp;
		    }
		    return shuffled.slice(0, size);
		}
	
		//Function for simply shuffling an array
		//From ???  It's another stackoverflow post.
		function shuffle(array) {
			var currentIndex = array.length, temporaryValue, randomIndex ;

				 // While there remain elements to shuffle...
				 while (0 !== currentIndex) {

				 	// Pick a remaining element...
				 	randomIndex = Math.floor(Math.random() * currentIndex);
				 	currentIndex -= 1;

				 	// And swap it with the current element.
				 	temporaryValue = array[currentIndex];
				 	array[currentIndex] = array[randomIndex];
				 	array[randomIndex] = temporaryValue;
				 }

			return array;
		}
		
	
		//To check to see if the new, changed image was in the original presentation, use this:
		//http://stackoverflow.com/questions/12623272/how-to-check-if-a-string-array-contains-one-string-in-javascript
		Array.prototype.contains = function(element){
		    return this.indexOf(element) > -1;
		};
	
		//A function to save the data to the SQL table on the psiturk server.  This gets called at the end of the file.
		function save_data(data_table,data){
		 	jsPsych.data.addProperties({stimulus: '', subject: psiturk.taskdata.get('workerId')}); 
		  	$.ajax({
	 		type:'post',
	  		cache: false,
				url: 'https://psiturk.psych.ucla.edu/~odegaard/sligteReplication/templates/savedata.php',//'https://psiturk.psych.ucla.edu/~odegaard/summaryperceptionRealExp3/psiTurkProject/templates/savedata.php',
		  	  	//Need to point this at the savedata.php in your own directory.  Why didn't this work locally???
		  	  	data: {
		     	table: data_table,
		      	json: JSON.stringify(data),
		      	//opt_data: {key: value}
		  		},
		  	  	success: function(output) { console.log(output); } // write the result to javascript console
		 		});
			}
	
			//Create the functions that convert canvas elements to URL strings
			//Most of these functions will be the screens with text to specify the instructions.
			function welcome_block() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Welcome to the experiment!  ", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("Please press the space bar when", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("you are ready to begin.", canvas.width/2, canvas.height/2 + 30);
				var welcometext = cueCanvas.toDataURL();
				var text4welcome = welcometext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4welcome;		
			}
			
			function questionPreface() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("First, we're going to ask you two", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("brief questions about your age and", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("gender. Press space bar to continue.", canvas.width/2, canvas.height/2 + 30);
				var welcometext = cueCanvas.toDataURL();
				var text4welcome = welcometext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4welcome;		
			}
			
			function questionGender() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Which gender best describes you?", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("Press Q if you identify as female.", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("Press P if you identify as male.", canvas.width/2, canvas.height/2 + 30);
				var welcometext = cueCanvas.toDataURL();
				var text4welcome = welcometext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4welcome;		
			}
			
			function questionAge() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("How old are you?", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("Enter you age WHERE?????", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("DERP DERP DERP", canvas.width/2, canvas.height/2 + 30);
				var welcometext = cueCanvas.toDataURL();
				var text4welcome = welcometext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4welcome;		
			}
	
			function instructions1() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("This experiment will try to assess ", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("how effectively you can do two things:", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("(1) Direct your attention to locations.", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("(2) Report things you have seen.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var instructions1text = cueCanvas.toDataURL();
				var text4instructions1 = instructions1text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions1;		
			}
	
			function instructions2() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Each trial in the experiment follows a  ", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("simple procedure.", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("We'll now show you how it will work.", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("Ready?", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to proceed.", canvas.width/2, canvas.height/2 + 90);
				var instructions2text = cueCanvas.toDataURL();
				var text4instructions2 = instructions2text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions2;		
			}
	
			function instructions3() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("At the start of each trial, a red dot will appear.", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("Whenever the red dot is on the screen,", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("make sure you look at the dot!", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("Press the space bar to see what the", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("red dot looks like.", canvas.width/2, canvas.height/2 + 90);
				var instructions3text = cueCanvas.toDataURL();
				var text4instructions3 = instructions3text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions3;		
			}
	
			function instructions4() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Whenever a trial is about to start,", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("the red dot changes to a green dot.", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("Press the space bar to see what this", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("process looks like.", canvas.width/2, canvas.height/2 + 60);
				var instructions4text = cueCanvas.toDataURL();
				var text4instructions4 = instructions4text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions4;		
			}
	
			function instructions5() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Make sure to always look at the red or green", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("dots whenever they are on the screen!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("After the dot turns green, images will appear", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("on the screen. Your goal is to try to pay", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("attention to all eight images at once, and", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("remember as many images as possible!", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("We know this is difficult, but simply try", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("to do the best you can! Press space bar.", canvas.width/2, canvas.height/2 + 150);
				var instructions5text = cueCanvas.toDataURL();
				var text4instructions5 = instructions5text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions5;		
			}
	
			function instructions6() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Keep in mind that when the images are", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("presented, it will be tempting to try to", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("look directly at them, but we want you to", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("keep looking at the dot the entire time!", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("We're now going to load all of the images,", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("and show them briefly on the screen.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Don't worry if the presentation lags.", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("After they load, they will present", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("cleanly and quickly! Press space bar.", canvas.width/2, canvas.height/2 + 150);
				var instructions6text = cueCanvas.toDataURL();
				var text4instructions6 = instructions6text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions6;		
			}
	
			function instructions7() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("In the real experiment, the images will be", canvas.width/2, canvas.height/2 - 180);
				cueContext.fillText("shown much more briefly than that example.", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("When the images are shown, you need to", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("stay looking at the red dot, but please", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("pay attention to all 8 images at once!", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("We know it's hard because they're in your", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("visual periphery, but try your best!", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Shortly after the images disappear,", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("a line will be presented, which labels", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("which location you'll be asked about", canvas.width/2, canvas.height/2 + 150);
				cueContext.fillText("later on. Press space bar to continue.", canvas.width/2, canvas.height/2 + 180);
				var instructions7text = cueCanvas.toDataURL();
				var text4instructions7 = instructions7text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions7;		
			}
	
			//This instructions block needs to change depending on whether you do DETECTION, or DISCRIMINATION.
			function instructions8() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("After the line disappears, images will be", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("presented a second time in a circle, and", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("you will be asked one or two questions.", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("One question you'll be asked on every", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("trial is whether the image at the location", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("of the line stayed the SAME, or CHANGED", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("from the 1st to the 2nd presentation.", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("Press space bar to try a few practice trials", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("that focus on this question", canvas.width/2, canvas.height/2 + 150);
				var instructions8text = cueCanvas.toDataURL();
				var text4instructions8 = instructions8text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions8;		
			}
	
			function instructions9() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Now let's get you started on a practice", canvas.width/2, canvas.height/2 - 180);
				cueContext.fillText("block to get you ready for the real", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("experiment.  In this practice block,", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("there are two things to note:", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("(1) Always keep your eyes on the dot when", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("it's on the screen! We know it's tempting", canvas.width/2, canvas.height/2 + 0 );
				cueContext.fillText("to look away, especially after the line has", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("been presented, but try to stay looking", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("at the dot", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("(2) Do your best to pay attention to all", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("8 images during the first presentation!", canvas.width/2, canvas.height/2 + 150);
				cueContext.fillText("Press space to start the practice.", canvas.width/2, canvas.height/2 + 180);
				var instructions9text = cueCanvas.toDataURL();
				var text4instructions9 = instructions9text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions9;		
			}
	
			function instructions10() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Here are a few extra details about the", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("real experiment.", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("FIRST, in the real experiment, you'll not", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("only try to detect whether the image", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("at the location of the 2nd line changed", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("after each trial, but you'll also have to", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("BET on how confident you are that you got", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("it right.  Press space to continue.", canvas.width/2, canvas.height/2 + 120);
				var instructions10text = cueCanvas.toDataURL();
				var text4instructions10 = instructions10text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions10;		
			}
	
			function instructions11() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You'll bet on a scale of 1-4. ", canvas.width/2, canvas.height/2 - 180);
				cueContext.fillText("If you are VERY certain of your answer,", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("you should bet 4 points.", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("If you're NOT VERY certain of answer,", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("you should bet 1 point.", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("If you're RIGHT, you'll earn the amount you", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("bet.  If you're WRONG, you'll lose the", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("amount that you bet. We recommend using", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("the entire betting range over the course", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("of the experiment. How well bets track", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("if you're right determines if you'll earn", canvas.width/2, canvas.height/2 + 150);
				cueContext.fillText("the $1 bonus. Press space bar to continue", canvas.width/2, canvas.height/2 + 180);
				var instructions11text = cueCanvas.toDataURL();
				var text4instructions11 = instructions11text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions11;		
			}
			
			function instructions11a() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Note that ALL betting responses will factor", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("in to whether or not you earn the $1 bonus,", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("so try to respond accurately when betting", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("on all trial types in the experiment. ", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("Press space bar to continue", canvas.width/2, canvas.height/2 + 60);
				var instructions11atext = cueCanvas.toDataURL();
				var text4instructions11a = instructions11atext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions11a;		
			}
	
			function instructions11b() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("NEXT, note that if the image DID change, we'll", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("show you four pictures, and ask which", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("image was presented in the FIRST group, ", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("at the location labeled by the line.", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("Following this, we'll ask you to make a", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("bet about how confident you are in this", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("particular response, too.", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("Press space bar to continue.", canvas.width/2, canvas.height/2 + 120);
				var instructions11btext = cueCanvas.toDataURL();
				var text4instructions11b = instructions11btext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions11b;		
			}
			
			function instructions11c() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("One more detail to note: in the real", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("experiment, the line that tells you which", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("image to pay attention to can show up at ", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("different times, like in the practice trials.", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("We know that some trials will feel harder", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("than others!  :)  Just try your best", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("to be as quick and accurate as possible.", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("Press space bar to continue.", canvas.width/2, canvas.height/2 + 120);
				var instructions11ctext = cueCanvas.toDataURL();
				var text4instructions11c = instructions11ctext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions11c;		
			}
	
			function instructions12() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("From here onwards, the rest of the ", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("experiment should take about 40 minutes ", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("to complete. You'll be allowed to take ", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("breaks every 9-10 minutes or so.", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("Do the best you can, stay focused, and", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("try your hardest! We really appreciate", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("your diligence & effort, and look forward", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("to analyzing your data to learn about", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("attention & the visual system.  Ready?", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("Press the space bar to begin the experiment!", canvas.width/2, canvas.height/2 + 180);
				var instructions12text = cueCanvas.toDataURL();
				var text4instructions12 = instructions12text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions12;		
			}
	
			function breakScreen() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Alright!", canvas.width/2, canvas.height/2 - 180);
				cueContext.fillText("You can now take a break.", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("We recommend resting for around one ", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("minute, but you can take longer if needed.", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("Two reminders:", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("(1) Always keep your eye on the dot, even", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("though it's tempting to look at the line!", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("(2) Don't forget to use the entire scale of", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("1-4 as you bet throughout the experiment!", canvas.width/2, canvas.height/2 + 150);
				cueContext.fillText("When ready, press space bar to start again", canvas.width/2, canvas.height/2 + 180);
				var breakScreentext = cueCanvas.toDataURL();
				var text4breakScreen = breakScreentext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4breakScreen;		
			}
	
			function endPractice() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Excellent!  You are now done with the", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("practice block.", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("Before you get started on the real experiment,", canvas.width/2, canvas.height/2 - 0);
				cueContext.fillText("there are a few extra details to learn.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var endPracticetext = cueCanvas.toDataURL();
				var text4endPractice = endPracticetext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4endPractice;		
			}
	
			function instructions4photos() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Excellent! Just a few final questions left.", canvas.width/2, canvas.height/2 - 180);
				cueContext.fillText("Some researchers think that our ability to", canvas.width/2, canvas.height/2 - 150);
				cueContext.fillText("visually see things clearly and in vivid", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("detail is relatively poor at the periphery", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("compared to the center of our gaze.", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("However, it has also been suggested that we", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("subjectively see the world somewhat", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("uniformly across the visual field.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("On the next screens, two photos will be ", canvas.width/2, canvas.height/2 + 90);
				cueContext.fillText("shown. Look at the center of each photo, ", canvas.width/2, canvas.height/2 + 120);
				cueContext.fillText("and then report what vision looks like", canvas.width/2, canvas.height/2 + 150);
				cueContext.fillText("to you. Press space bar to continue.", canvas.width/2, canvas.height/2 + 180);
				var instructions4photostext = cueCanvas.toDataURL();
				var text4instructions4photos = instructions4photostext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4instructions4photos;		
			}
	
			function correct1() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are CORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were DIFFERENT between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var correct1text = cueCanvas.toDataURL();
				var text4correct1 = correct1text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4correct1;		
			}
	
			function incorrect1() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are INCORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were DIFFERENT between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var incorrect1text = cueCanvas.toDataURL();
				var text4incorrect1 = incorrect1text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4incorrect1;		
			}
	
			function correct2() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are CORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were THE SAME between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var correct2text = cueCanvas.toDataURL();
				var text4correct2 = correct2text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4correct2;		
			}
	
			function incorrect2() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are INCORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were THE SAME between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var incorrect2text = cueCanvas.toDataURL();
				var text4incorrect2 = incorrect2text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4incorrect2;		
			}
	
			function correct3() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are CORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were DIFFERENT between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var correct3text = cueCanvas.toDataURL();
				var text4correct3 = correct3text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4correct3;		
			}
	
			function incorrect3() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are INCORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were DIFFERENT between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var incorrect3text = cueCanvas.toDataURL();
				var text4incorrect3 = incorrect3text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4incorrect3;		
			}
	
			function correct4() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are CORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were THE SAME between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var correct4text = cueCanvas.toDataURL();
				var text4correct4 = correct4text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4correct4;		
			}
	
			function incorrect4() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("You are INCORRECT!", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("The images at the location of the line", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("were THE SAME between the 1st", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("presentation and the 2nd presentation.", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press the space bar to continue.", canvas.width/2, canvas.height/2 + 90);
				var incorrect4text = cueCanvas.toDataURL();
				var text4incorrect4 = incorrect4text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4incorrect4;		
			}
			
			function shortRight() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("CORRECT", canvas.width/2, canvas.height/2 - 0);
				var shortCorrect4text = cueCanvas.toDataURL();
				var text4shortCorrect = shortCorrect4text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4shortCorrect;	
			}
			
			function shortWrong() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("INCORRECT", canvas.width/2, canvas.height/2 - 0);
				var shortIncorrect4text = cueCanvas.toDataURL();
				var text4shortIncorrect = shortIncorrect4text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4shortIncorrect;	
			}
	
			function catchtrial1() {
				cueContext.font = "bold 48px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("d  ", canvas.width/2 + 20, canvas.height/2 + 75);
				var catchtrial1text = cueCanvas.toDataURL();
				var text4catchtrial1 = catchtrial1text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4catchtrial1;			
			}

			function catchtrial2() {
				cueContext.font = "bold 48px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("b  ", canvas.width/2 + 20, canvas.height/2 + 75);
				var catchtrial2text = cueCanvas.toDataURL();
				var text4catchtrial2 = catchtrial2text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4catchtrial2;		
			}

			function catchtrial3() {
				cueContext.font = "bold 48px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("c  ", canvas.width/2 + 20, canvas.height/2 + 75);
				var catchtrial3text = cueCanvas.toDataURL();
				var text4catchtrial3 = catchtrial3text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4catchtrial3;			
			}

			function catchtrial4() {
				cueContext.font = "bold 48px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("a  ", canvas.width/2 + 20, canvas.height/2 + 75);
				var catchtrial4text = cueCanvas.toDataURL();
				var text4catchtrial4 = catchtrial4text;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4catchtrial4;			
			}

			function catchtrialquestion() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("Quick question to make sure ", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("you're paying attention!  :)", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("What letter was just shown on your screen?", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("Enter a, b, c, or d on your keyboard.", canvas.width/2, canvas.height/2 + 60);
				var catchtrialquestiontext = cueCanvas.toDataURL();
				var text4catchtrialquestion = catchtrialquestiontext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4catchtrialquestion;	
			}
	
			function createBlank() {
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				var string4blank = cueCanvas.toDataURL();
				Blank2use = string4blank;
				return Blank2use;
			}
	
			function detectQuestion() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("For the image the line pointed to,", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("is it the SAME, or is it DIFFERENT from", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("the first presentation at that location?", canvas.width/2, canvas.height/2 - 30);
				cueContext.fillText("Press Q if you think it stayed the SAME", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press P if you think it is DIFFERENT", canvas.width/2, canvas.height/2 + 60);
				var detectiontext = cueCanvas.toDataURL();
				var text4detection = detectiontext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4detection;		
			}
	
			function confQuestion() {
				cueContext.font = "bold 24px sans-serif";
				cueContext.textAlign = "center";
				cueContext.textBaseline = "middle";
				cueContext.fillText("How many points are you willing to bet", canvas.width/2, canvas.height/2 - 120);
				cueContext.fillText("on your response?  Choose from 1 to 4", canvas.width/2, canvas.height/2 - 90);
				cueContext.fillText("to select the number of points to bet.", canvas.width/2, canvas.height/2 - 60);
				cueContext.fillText("Press 4 if you are very sure", canvas.width/2, canvas.height/2 + 0);
				cueContext.fillText("Press 3 if you are quite sure", canvas.width/2, canvas.height/2 + 30);
				cueContext.fillText("Press 2 if you are somewhat sure", canvas.width/2, canvas.height/2 + 60);
				cueContext.fillText("Press 1 if you are not at all sure", canvas.width/2, canvas.height/2 + 90);
				var confidencetext = cueCanvas.toDataURL();
				var text4confidence = confidencetext;
				cueContext.clearRect(0, 0, canvas.width, canvas.height);
				return text4confidence;		
			}
	
			//Call those functions so the variable can be used by plugins.
			//Just putting the URL string produced by the functions into a variable here.
			var welcome4intro = welcome_block();
			var prefaceQ = questionPreface();
			var genderQ = questionGender();
			var ageQ = questionAge();
			var instruct1 = instructions1();
			var instruct2 = instructions2();
			var instruct3 = instructions3();
			var instruct4 = instructions4();
			var instruct5 = instructions5();
			var instruct6 = instructions6();
			var instruct7 = instructions7();
			var instruct8 = instructions8();
			var instruct9 = instructions9();
			var instruct10 = instructions10();
			var instruct11 = instructions11();
			var instruct11a = instructions11a();
			var instruct11b = instructions11b();
			var instruct11c = instructions11c();
			var instruct12 = instructions12();
	
			var brkscrn = breakScreen();
			var stopPractice = endPractice();
			var photoinstr = instructions4photos();
	
			var right1 = correct1();
			var wrong1 = incorrect1();
			var right2 = correct2();
			var wrong2 = incorrect2();
			var right3 = correct3();
			var wrong3 = incorrect3();
			var right4 = correct4();
			var wrong4 = incorrect4();
			var shortCorrect = shortRight();
			var shortIncorrect = shortWrong();
	
			var ct1 = catchtrial1();
			var ct2 = catchtrial2();
			var ct3 = catchtrial3();
			var ct4 = catchtrial4();
			var ctquestion = catchtrialquestion();
			var blank = createBlank();
	
			var detectionQ = detectQuestion();
			var confidenceQ = confQuestion();
	
	
			//Implement a plugin call
			var welcome = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: welcome4intro, 
				timing_stim: [-1],
			    choices: [[32]] 
			}; 
			
			var prefaceQuestion = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: prefaceQ, 
				timing_stim: [-1],
			    choices: [[32]] 
			}; 
			
			var genderQuestion = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: genderQ, 
				timing_stim: [-1],
			    choices: [81,80] 
			}; 
			
			var ageQuestion = { 
				type: 'survey-text', 
				display_element: $('#jspsych-target'),
				questions: ["How old are you? Please respond using numbers (for example, 23) below."]
			};  
	
			var instr1 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct1, 
				timing_stim: [-1],
			    choices: [[32]] 
			}; 
	
			var instr2 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct2, 
				timing_stim: [-1],
			    choices: [[32]] 
			}; 
	
			var instr3 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct3, 
				timing_stim: [-1],
			    choices: [[32]] 
			}; 
	
			var fixation_redexample = 
			{
				type: "fixation-stim",
				display_element:$('#stimuli-target'),
				fixation_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				fixation_color: 'red',
				timing_fixation: 1000,
				timing_post_trial: 0
			};
	
			var instr4 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct4, 
				timing_stim: [-1],
			    choices: [[32]] 
			}; 
	
			var fixation_greenexample = 
			{
				type: "fixation-stim",
				display_element:$('#stimuli-target'),
				fixation_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				fixation_color: 'green',
				timing_fixation: 1000,
				timing_post_trial: 0
			};
	
			var instr5 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct5, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var cue_example = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 7;
					//return Math.floor(Math.random() * 8);
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 2000,
				timing_post_trial: 0
			}; 
	
			var instr6 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct6, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var instr7 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct7, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var instr8 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct8, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var instr9 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct9, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var instr10 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct10, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var instr11 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct11, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
			
			var instr11a = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct11a, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var instr11b = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct11b, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
			
			var instr11c = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct11c, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var instr12 = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: instruct12, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var takeBreak = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: brkscrn, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var practiceEnd = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: stopPractice, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var photoInstructions = { 
				type: 'single-stim', 
				display_element: $('#jspsych-target'),
				stimuli: photoinstr, 
				timing_stim: [-1],
			    choices: [[32]] 
			};
	
			var fixation_redpractice = 
			{
				type: "fixation-stim",
				display_element:$('#stimuli-target'),
				fixation_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				fixation_color: 'red',
				timing_fixation: 500,
				timing_post_trial: 0
			};
	
			var fixation_greenpractice = 
			{
				type: "fixation-stim",
				display_element:$('#stimuli-target'),
				fixation_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				fixation_color: 'green',
				timing_fixation: 500,
				timing_post_trial: 0
			};
	
			var cue_practice1 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 0;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			}; 
	
			var cue_practice2 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 0;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			};
	
			var cue_practice3 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 4;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			};
	
			var cue_practice4 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 4;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			};
	
			var cue_practice5 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 6;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			};
	
			var cue_practice6 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 2;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			};
	
			var cue_practice7 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 2;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			};
	
			var cue_practice8 = 
			{
				//Note that a few things are hard-coded in the example cue.
				type: "cue-stim",
				display_element: $('#stimuli-target'),
				set_size: 8,
				cue_position: function()
				{
					return 6;
				},
				cue_size: cue_size,
				circle_diameter: circle_diameter,
				target_size: [target_size, target_size],
				timing_cue: 500,
				timing_post_trial: 0
			};
	
		   var stimulusct1 = {
			   type: 'multi-stim-multi-response',
			   display_element: $('#jspsych-target'),
			   stimuli: [[blank,blank,ct1]],	
			   timing_stim: [200,200,1000],
			   choices: [[]],
			   timing_response: [1400],
			   response_ends_trial: false,
			   data: function() 
			   {
				  return {catchTrial: 1};
			   }
			   //on_finish: [function() {jsPsych.data.addProperties({catchtrial: 1})}]
		   };

		   var stimulusct2 = {
			   type: 'multi-stim-multi-response',
			   display_element: $('#jspsych-target'),
			   stimuli: [[blank,blank,ct2]],	
			   timing_stim: [200,200,1000],
			   choices: [[]],
			   timing_response: [1400],
			   response_ends_trial: false,
			   data: function() 
			   {
				  return {catchTrial: 1};
			   }
		   };	

		   var stimulusct3 = {
			   type: 'multi-stim-multi-response',
			   display_element: $('#jspsych-target'),
			   stimuli: [[blank,blank,ct3]],	
			   timing_stim: [200,200,1000],
			   choices: [[]],
			   timing_response: [1400],
			   response_ends_trial: false,
			   data: function() 
			   {
				  return {catchTrial: 1};
			   }
		   };	

		   var stimulusct4 = {
			   type: 'multi-stim-multi-response',
			   display_element: $('#jspsych-target'),
			   stimuli: [[blank,blank,ct4]],	
			   timing_stim: [200,200,1000],
			   choices: [[]],
			   timing_response: [1400],
			   response_ends_trial: false,
			   data: function() 
			   {
				  return {catchTrial: 1};
			   }
		   };
   
			var catchtrialquestionfinal = {
				type: 'single-stim',
				display_element: $('#jspsych-target'),
				stimuli: ctquestion,
				timing_stim: [-1],
				timing_response: [-1],
				choices: [65,66,67,68],
				response_ends_trial: true,
 			    data: function() 
 			    {
 				   return {catchTrial: 1};
 			    }
			};
	
			var detectionQuestion = {
				type: 'single-stim',
				display_element: $('#jspsych-target'),
				stimuli: detectionQ,
				timing_stim: [-1],
				choices: [81,80],
				data: function() 
				{
					var data = jsPsych.data.getLastTrialData();
					return {cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, memoryStimulus: data.memoryStimulus, targetChange: data.targetChange};
				}
			};
	
			var confidenceQuestionDetection = {
				type: 'single-stim',
				display_element: $('#jspsych-target'),
				stimuli: confidenceQ,
				timing_stim: [-1],
				choices: [49,50,51,52],
				data: function() 
				{
					var data = jsPsych.data.getLastTrialData();
					var detectOrDiscriminate = 1;				
					return {cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, memoryStimulus: data.memoryStimulus, targetChange: data.targetChange, choice: data.key_press, correct: data.correct, detectDiscriminate: detectOrDiscriminate};
				}
			};
			
			var confidenceQuestionDiscrimination = {
				type: 'single-stim',
				display_element: $('#jspsych-target'),
				stimuli: confidenceQ,
				timing_stim: [-1],
				choices: [49,50,51,52],
				data: function() 
				{
					var data = jsPsych.data.getLastTrialData();
					var detectOrDiscriminate = 2;				
					return {cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, memoryStimulus: data.memoryStimulus, targetChange: data.targetChange, choice: data.key_press, correct: data.correct, detectDiscriminate: detectOrDiscriminate};
				}
			};
	
	
			//Here's an extra call that's necessary to use Jason's fixation cross stimulus.
			var fixation = draw_fixation(cue_size);
	
	
			//Load the paths for the images we'll use in the task (let's do 50 to start out with).
			//B/c the images on page 10 of the Sligte article aren't in any order, let's avoid
			//"for" loops here and just write out the custom paths ourselves.
			var stim1 = '../static/images/SVLO/003.png';
		    var stim2 = '../static/images/SVLO/006.png';
		    var stim3 = '../static/images/SVLO/008.png';
		    var stim4 = '../static/images/SVLO/014.png';
		    var stim5 = '../static/images/SVLO/015.png';
		    var stim6 = '../static/images/SVLO/016.png';
		    var stim7 = '../static/images/SVLO/022.png';
		    var stim8 = '../static/images/SVLO/025.png';
			var stim9 = '../static/images/SVLO/028.png';
			var stim10 = '../static/images/SVLO/030.png';
			var stim11 = '../static/images/SVLO/032.png';
			var stim12 = '../static/images/SVLO/033.png';
			var stim13 = '../static/images/SVLO/036.png';
			var stim14 = '../static/images/SVLO/039.png';
			var stim15 = '../static/images/SVLO/040.png';
			var stim16 = '../static/images/SVLO/041.png';
			var stim17 = '../static/images/SVLO/047.png';
			var stim18 = '../static/images/SVLO/048.png';
			var stim19 = '../static/images/SVLO/054.png';
			var stim20 = '../static/images/SVLO/055.png';
			var stim21 = '../static/images/SVLO/060.png';
			var stim22 = '../static/images/SVLO/061.png';
			var stim23 = '../static/images/SVLO/063.png';
			var stim24 = '../static/images/SVLO/067.png';
			var stim25 = '../static/images/SVLO/069.png';
			var stim26 = '../static/images/SVLO/074.png';
			var stim27 = '../static/images/SVLO/078.png';
			var stim28 = '../static/images/SVLO/084.png';
			var stim29 = '../static/images/SVLO/086.png';
			var stim30 = '../static/images/SVLO/090.png';
			var stim31 = '../static/images/SVLO/091.png';
			var stim32 = '../static/images/SVLO/100.png';
			var stim33 = '../static/images/SVLO/103.png';
			var stim34 = '../static/images/SVLO/111.png';
			var stim35 = '../static/images/SVLO/112.png';
			var stim36 = '../static/images/SVLO/119.png';
			var stim37 = '../static/images/SVLO/129.png';
			var stim38 = '../static/images/SVLO/135.png';
			var stim39 = '../static/images/SVLO/138.png';
			var stim40 = '../static/images/SVLO/146.png';
			var stim41 = '../static/images/SVLO/147.png';
			var stim42 = '../static/images/SVLO/166.png';
			var stim43 = '../static/images/SVLO/172.png';
			var stim44 = '../static/images/SVLO/204.png';
			var stim45 = '../static/images/SVLO/211.png';
			var stim46 = '../static/images/SVLO/217.png';
			var stim47 = '../static/images/SVLO/220.png';
			var stim48 = '../static/images/SVLO/222.png';
			var stim49 = '../static/images/SVLO/232.png';
			var stim50 = '../static/images/SVLO/239.png';
	
	
			//Create a master array to sample the images on every trial from.	
			var imageArray = [stim1, stim2, stim3, stim4, stim5, stim6, stim7, stim8, stim9, stim10, stim11, stim12, stim13, stim14, stim15, stim16, stim17, stim18, stim19, stim20, stim21, stim22, stim23, stim24, stim25, stim26, stim27, stim28, stim29, stim30, stim31, stim32, stim33, stim34, stim35, stim36, stim37, stim38, stim39, stim40, stim41, stim42, stim43, stim44, stim45, stim46, stim47, stim48, stim49, stim50];
	
	
			//Create examples to use for presentations BEFORE the real experiment starts.
			var exampleStim = [stim1, stim2, stim3, stim4, stim5, stim6, stim7, stim8];
			var exampleStim1 = [stim1, stim2, stim3, stim4, stim5, stim6, stim7, stim8];
			var exampleStim1a = [stim1, stim2, stim3, stim4, stim5, stim6, stim7, stim8];
			var exampleStim1b = [stim9, stim10, stim11, stim12, stim13, stim14, stim15, stim16];
			var exampleStim1c = [stim17, stim18, stim19, stim20, stim21, stim22, stim23, stim24];
			var exampleStim1d = [stim25, stim26, stim27, stim28, stim29, stim30, stim31, stim32];
			var exampleStim1e = [stim33, stim34, stim35, stim36, stim37, stim38, stim39, stim40];
			var exampleStim1f = [stim41, stim42, stim43, stim44, stim45, stim46, stim47, stim48];
			var exampleStim1g = [stim49, stim50, stim1, stim2, stim3, stim4, stim5, stim6];
			var exampleStim2 = [stim9, stim2, stim3, stim4, stim5, stim6, stim7, stim8];
			var exampleStim3 = [stim10, stim11, stim12, stim13, stim14, stim15, stim16, stim17];
			var exampleStim4 = [stim10, stim11, stim12, stim13, stim14, stim15, stim16, stim17];
			var exampleStim5 = [stim18, stim19, stim20, stim21, stim22, stim23, stim24, stim25];
			var exampleStim6 = [stim18, stim19, stim26, stim21, stim22, stim23, stim24, stim25];
			var exampleStim7 = [stim27, stim28, stim29, stim30, stim31, stim32, stim33, stim34];
			var exampleStim8 = [stim27, stim28, stim29, stim30, stim31, stim32, stim33, stim34];
	
	
			var example_images = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 4000,
				timing_post_trial: 0
			};
	
	
			var example_images1 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var example_images1a = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1a);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 6000,
				timing_post_trial: 0
			};
	
			var example_images1b = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1b);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 6000,
				timing_post_trial: 0
			};
	
			var example_images1c = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1c);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 6000,
				timing_post_trial: 0
			};
	
			var example_images1d = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1d);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 6000,
				timing_post_trial: 0
			};
	
			var example_images1e = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1e);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 6000,
				timing_post_trial: 0
			};
	
			var example_images1f = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1f);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 6000,
				timing_post_trial: 0
			};
	
			var example_images1g = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim1g);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 6000,
				timing_post_trial: 0
			};
	
			var example_images2 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim2);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var example_images3 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim3);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var example_images4 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim4);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var example_images5 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim5);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var example_images6 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim6);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var example_images7 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim7);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var example_images8 = {
				type: "circle-stim",
				display_element: $('#stimuli-target'),
				stimuli: [function()
				{
					return (exampleStim8);
				}],
				targetStimPos: function()
				{

				},
				target_size: [target_size, target_size],
				circle_diameter: circle_diameter,
				cont_key: 'none',
				timing_max_search: 500,
				timing_post_trial: 0
			};
	
			var comparefirstpractice = {
				type:'single-stim',
				stimuli: function(){
					var data = jsPsych.data.getLastTrialData();
					var response = JSON.parse(data.key_press);
					if (response===81) {
						return wrong1;
					} else {
						return right1;
					}
				},
				timing_stim: [-1],
				timing_response: [-1],
				choices: [[32]]
			};
	
			var comparesecondpractice = {
				type:'single-stim',
				stimuli: function(){
					var data = jsPsych.data.getLastTrialData();
					var response = JSON.parse(data.key_press);
					if (response===81) {
						return right2;
					} else {
						return wrong2;
					}
				},
				timing_stim: [-1],
				timing_response: [-1],
				choices: [[32]]
			};
	
			var comparethirdpractice = {
				type:'single-stim',
				stimuli: function(){
					var data = jsPsych.data.getLastTrialData();
					var response = JSON.parse(data.key_press);
					if (response===81) {
						return wrong3;
					} else {
						return right3;
					}
				},
				timing_stim: [-1],
				timing_response: [-1],
				choices: [[32]]
			};
	
			var comparefourthpractice = {
				type:'single-stim',
				stimuli: function(){
					var data = jsPsych.data.getLastTrialData();
					var response = JSON.parse(data.key_press);
					if (response===81) {
						return right4;
					} else {
						return wrong4;
					}
				},
				timing_stim: [-1],
				timing_response: [-1],
				choices: [[32]]
			};
			
			
			var isDetectCorrect = [];
			
			
			var compareDetection = {
				type:'single-stim',
				stimuli: function(){
					var data = jsPsych.data.getLastTrialData();
					if (data.targetChange===0) {
						if (data.choice===80) {
							isDetectCorrect = true;
							return shortCorrect;
							
						} else {
							isDetectCorrect = false;
							return shortIncorrect;
							
						}				
					} else if (data.targetChange===1) {
						if (data.choice===80) {
							isDetectCorrect = true;
							return shortCorrect;
							
						} else {
							isDetectCorrect = false;
							return shortIncorrect;
							
						}
					} else if (data.targetChange===2) {
						if (data.choice===80) {
							isDetectCorrect = true;
							return shortCorrect;
							
						} else {
							isDetectCorrect = false;
							return shortIncorrect;
							
						}
					} else if (data.targetChange===3) {
						if (data.choice===81) {
							isDetectCorrect = true;
							return shortCorrect;
							
						} else {
							isDetectCorrect = false;
							return shortIncorrect;
							
						}
					} else if (data.targetChange===4) {
						if (data.choice===81) {
							isDetectCorrect = true;
							return shortCorrect;
							
						} else {
							isDetectCorrect = false;
							return shortIncorrect;
							
						}
					} else if (data.targetChange===5) {
						if (data.choice===81) {
							isDetectCorrect = true;
							return shortCorrect;
							
						} else {
							isDetectCorrect = false;
							return shortIncorrect;
							
						}
					}
				},
				timing_stim: [600],
				timing_response: [600],
				response_ends_trial: false,
				data: function() 
				{
					var data = jsPsych.data.getLastTrialData();				
					return {cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, memoryStimulus: data.memoryStimulus, targetChange: data.targetChange, correct: isDetectCorrect, detectDiscriminate: 3};
				}
			};
			
			var compareDiscrimination = {
				type:'single-stim',
				stimuli: function() {
					var data = jsPsych.data.getLastTrialData();
					if (data.correct===true) {
						return shortCorrect;
					} else {
						return shortIncorrect;
					}				
				},
				timing_stim: [600],
				timing_response: [600],
				response_ends_trial: false
			};
	
		    var ka_photos = {
		        type: 'similarity',
		        stimuli: [['../static/images/Loading.png','../static/images/KaPhotos2.png']],
				display_element: $('#photo-target'),
		        labels: ['Very similar to this image','Somewhat Similar','Somewhere in Between','Somewhat Similar','Very Similar to this image'],
		        is_html: false,
		        intervals: 100,
		        show_ticks: true,
		        show_response: "SECOND_STIMULUS",
		        timing_first_stim: 500,
		        timing_second_stim: -1,
		        timing_image_gap: -1,
				prompt: '<center><p>Look at the center of each photo.  Report what vision looks like to you!</p>',
				data: function() 
				{
					return {detectDiscriminate: 4};
				}
		    };
	
		    var cohen2016_fig1 = {
		        type: 'similarity',
		        stimuli: [['../static/images/Loading.png','../static/images/CohenFigure1.png']],
				display_element: $('#photo-target'),
		        labels: ['Very similar to this image','Somewhat Similar','Somewhere in Between','Somewhat Similar','Very Similar to this image'],
		        is_html: false,
		        intervals: 100,
		        show_ticks: true,
		        show_response: "SECOND_STIMULUS",
		        timing_first_stim: 500,
		        timing_second_stim: -1,
		        timing_image_gap: -1,
				prompt: '<center><p>Look at the center of each photo.  Report what vision looks like to you!</p>',
				data: function() 
				{
					return {detectDiscriminate: 5};
				}

		    };
	
		    var cohen2016_fig3 = {
		        type: 'similarity',
		        stimuli: [['../static/images/Loading.png','../static/images/CohenFigure3.png']],
				display_element: $('#photo-target'),
		        labels: ['Very similar to this image','Somewhat Similar','Somewhere in Between','Somewhat Similar','Very Similar to this image'],
		        is_html: false,
		        intervals: 100,
		        show_ticks: true,
		        show_response: "SECOND_STIMULUS",
		        timing_first_stim: 500,
		        timing_second_stim: -1,
		        timing_image_gap: -1,
				prompt: '<center><p>Look at the center of each photo.  Report what vision looks like to you!</p>',
				data: function() 
				{
					return {detectDiscriminate: 6};
				}
		    };
	
	
			//Creating a duplicate array to mess with in the lineup plugin later on.
			var array4Lineup = imageArray;
			//Creating a function to compare two matrices to get unique elements to sample from.
			//http://stackoverflow.com/questions/1187518/javascript-array-difference
			Array.prototype.diff = function(a) {
			    return this.filter(function(i) {return a.indexOf(i) < 0;});
			};
	
	
			//Create an index array with numbers to use to select these images.
			//Note that imageArray and imageIndex must have the same number of elements (i.e., the number of total images).
		  	imageIndex = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49];
	
	
			//Determine the total number of trials that you want in the experiment.
			//Remember, numTrials needs to be the sum of BOTH the practice trials and the real trials.
			//numPracticeTrials just tells you how many practice trials there are.
			var numTrials = 190;
			var numPracticeTrials = 10;
			//Determine how many images per trial you want to show in the experiment.
			var images2show = 8;
			var initialCuePositions = [];
			var invalidMemoryPositions = [];

	
	
			//Create an array with all of the initial cue positions.  The initial cue will be placed randomly.
			for (d=0; d < numTrials; d++) {
				initialCuePositions[d] = Math.floor(Math.random() * images2show);
			}
	

			//Now, create an array of positions OTHER than the initial cue position.  You'll need these positions
			//as a reference on invalid trials (this was the best method I could come up with to save the position)
			for (e=0; e < numTrials; e++) {
				invalidMemoryPositions[e] = Math.floor(Math.random() * images2show);
				//Make sure you don't duplicate the initial cue position and the other position you want to sample.
				while (invalidMemoryPositions[e] === initialCuePositions[e]) {
					invalidMemoryPositions[e] = Math.floor(Math.random() * images2show);
				}
			}
	
	
			//Build the master stimulus presentation matrix, with eight new, unique images for every trial.
			var masterImageArray = [];
			var eightImages2Use = getRandomSubarray(imageIndex, images2show);
	
			for (l = 0; l < numTrials; l++){
			    var eightImages2Use = getRandomSubarray(imageIndex, images2show);
			    for (var m=0; m < eightImages2Use.length; m++) {
			      masterImageArray.push( eightImages2Use[m] );
			    } 
			}
		
	
			//Create an array that labels whether the trial will have a valid or invalid attentional cue.
			//For this array, 1's will be valid trials, and 0's will be invalid trials.
			//For this experiment, I'll concatenate the practice block onto the start of the overall array.
			//Note that imageValid must have the same number of elements as the number of experimental trials.
			//Also note that this matrix gets concatenated with the vector of practice trials 
			var	imageValid = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];
			//SHUFFLE the imageValid matrix.  We want the order of trials to be unique for each participant.
	
	
			//DON'T SHUFFLE this matrix.  The practice trials are hard-coded.
			var imageValidPractice = [1,1,1,1,1,1,1,1,1,1];
			//var imageValidPractice = [1,1,1,1,1,1,1,1,1,1];
	
			var imageValid = imageValidPractice.concat(imageValid);
	
	
			//imageValid = shuffle(imageValid);
			var validArrayIndex1 = -1;
			var validArrayIndex2 = -1;
			var validArrayIndex3 = -1;
			var validArrayIndex4 = -1;
			var validArrayIndex5 = -1;
			var validArrayIndex6 = -1;
			var validArrayIndex7 = -1;
			var validArrayIndex8 = -1;
	
	
	
			//Create an array that will determine whether or not the target image changed
			//Note that targetChange must have the same number of elements as specified in numTrials.
			var targetChange = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
			//var targetChange = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];
			//var targetChange = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];
			//var targetChange = [2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2];
			//var targetChange = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
			//var targetChange = [3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3];
			//var targetChange = [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4];
			//SHUFFLE the targetChange matrix.  We want the order ot trials to be unique for each participant.
			// Add shuffled code here.
			targetChange = shuffle(targetChange);
	
			//DON'T Shuffle this target Change Practice matrix.  I hard-coded the practice trials.
			var targetChangePractice = [1,2,3,4,5,0,2,3,5,1];
			//var targetChangePractice = [0,0,1,1,0,1,0,0,1,1];
			var targetChange = targetChangePractice.concat(targetChange);
	
	
			//Create the "circleStim" variable that you'll need in the code below this section
			//Note that initializing these variables OUTSIDE of the plugin call allows them 
			//to be used throughout different parameters of the plugin.
			var circleStim = [];
			var circleStim2 = [];
			var circleStim3 = [];
			var quadStim = [];
			var newImage = [];
			var newStimIndex = [];
			var image1 = [];
			var image2 = [];
			var image3 = [];
			var image4 = [];


			//	Initialize the experiment array (i.e., the timeline in jsPsych 4.3)
			var experiment = [];
	
	
			//Push the initial welcome/instruction screens to that array
			//These are the screens that should only show up once, right at the beginning.
			experiment.push(welcome);
			experiment.push(prefaceQuestion);
			experiment.push(genderQuestion);
			experiment.push(ageQuestion);
			experiment.push(instr1);
			experiment.push(instr2);
			experiment.push(instr3);
			experiment.push(fixation_redexample);
			experiment.push(instr4);
			experiment.push(fixation_redexample);
			experiment.push(fixation_greenexample);
			experiment.push(instr5);
			experiment.push(instr6);
			experiment.push(example_images1a);
			experiment.push(example_images1b);
			experiment.push(example_images1c);
			experiment.push(example_images1d);
			experiment.push(example_images1e);
			experiment.push(example_images1f);
			experiment.push(example_images1g);
			experiment.push(instr7);
			experiment.push(instr8);
			experiment.push(fixation_redpractice);
			experiment.push(fixation_greenpractice);
			experiment.push(example_images1);
			experiment.push(fixation_redpractice);
			experiment.push(cue_practice2);
			experiment.push(fixation_redpractice);
			experiment.push(example_images2);
			experiment.push(detectionQuestion);
			experiment.push(comparefirstpractice);
			experiment.push(fixation_redpractice);
			experiment.push(fixation_greenpractice);
			experiment.push(example_images3);
			experiment.push(cue_practice4);
			experiment.push(fixation_redpractice);
			experiment.push(example_images4);
			experiment.push(detectionQuestion);
			experiment.push(comparesecondpractice);
			experiment.push(fixation_redpractice);
			experiment.push(fixation_greenpractice);
			experiment.push(example_images5);
			experiment.push(cue_practice6);
			experiment.push(fixation_redpractice);
			experiment.push(example_images6);
			experiment.push(detectionQuestion);
			experiment.push(comparethirdpractice);
			experiment.push(fixation_redpractice);
			experiment.push(fixation_greenpractice);
			experiment.push(example_images7);
			experiment.push(cue_practice8);
			experiment.push(fixation_redpractice);
			experiment.push(example_images8);
			experiment.push(detectionQuestion);
			experiment.push(comparefourthpractice);
			experiment.push(instr9);


			//Create the loop that will create each trial.
			//I'm going to have this loop build both the practice block and the real experiment block.
			//This loop will also load things into the experiment structure at the end
			//I add one to numTrials to go into the loop that asks the questions about the photos.
			for (var t = 0; t < numTrials; t++)
			{
		
				//Present the fixation cross
				var fixation_block1 = 
				{
					type: "fixation-stim",
					display_element:$('#stimuli-target'),
					fixation_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					fixation_color: 'red',
					timing_fixation: 500,
					timing_post_trial: 0
				};
		
				var fixation_block2 = 
				{
					type: "fixation-stim",
					display_element:$('#stimuli-target'),
					fixation_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					fixation_color: 'green',
					timing_fixation: 1000,
					timing_post_trial: 0
				};
		
		
				var pre_stimulus_cue_block = 
				{
					type: "cue-stim",
					display_element: $('#stimuli-target'),
					set_size: images2show,
					cue_position: function()
					{
						validArrayIndex5 += 1;
						//Note that the first cue position will be shown at a random location.
						var cueLocation = initialCuePositions[validArrayIndex5];		
						return cueLocation;
					},
					cue_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					timing_cue: 150,
					timing_post_trial: 0,
					data: function() 
					{
						//Note: I tried to use a new index here, but it doubled up on each loop ( was only supposed to go +1 ).
						//Why would an index count twice here???  It doesn't make any sense.
						//I checked it, debugged, and verified it.  Going with validArrayIndex5 instead . . . 
						//AND that works.  So for future ref: just use one index iteration throughout a plugin, I guess.
						var memPos = invalidMemoryPositions[validArrayIndex5];
						if (imageValid[validArrayIndex5] === 1) {
							var targetPos = initialCuePositions[validArrayIndex5];
							var validTrial = 1;
						} else {
							var targetPos = memPos;
							var validTrial = 0;
						}
						//Yo.  This is wrong, b/c you use targetSwitch in a different way below.
						//Forgetting what variable names after months away is a b****!  BUT, this got fixed in experiment 2, and didn't disrupt the current version
						//because this variable gets overwritten.  But don't do it again.
						//I only discovered this when debugging experiment 2.
						if (targetChange[validArrayIndex5] === 0|1|2) {
							var targetSwitch = 1;
						} else {
							var targetSwitch = 0;
						}
				
						return {invalidPosition: memPos, target_position: targetPos, validTrial: validTrial, targetChange: targetSwitch};
					}
			
				};
		
		
				var circle_block1 = {
					type: "circle-stim",
					display_element: $('#stimuli-target'),
					stimuli: [function()
					{
						//Create the stimuli dynamically on each trial by indexing the masterImageArray.
						validArrayIndex1 += 1;
						for (j = 0; j < images2show; j++) {
						  circleStim[j] = imageArray[masterImageArray[j + validArrayIndex1*8]]
						}
						return circleStim;
					}],
					targetStimPos: function()
					{
						var data = jsPsych.data.getLastTrialData();
						return data.cue_position;
					},
					target_size: [target_size, target_size],
					circle_diameter: circle_diameter,
					cont_key: 'none',
					timing_max_search: 250,
					timing_post_trial: 0,
					data: function()
					{
						var data = jsPsych.data.getLastTrialData();
						//Get the cue position to show after this image presentation.
						var cueLocation = initialCuePositions[validArrayIndex1];	
						//Get the target position, which is always valid in this code.  (Based on old code.  I made everything valid.)
						if (imageValid[validArrayIndex1] === 1) {
							var targetPos = initialCuePositions[validArrayIndex1];
							var validTrial = 1;
						} else {
							var targetPos = memPos; //I think this is wrong, no?  memPos isn't defined until later, so you need data.invalidPosition, I think.
							var validTrial = 0;
						}
				
						//Figure out whether the garget is supposed to change, and then label the trial as needed.
						if (targetChange[validArrayIndex1] === 0) {
							var targetSwitch = 0;
						} else if (targetChange[validArrayIndex1] === 1) {
							var targetSwitch = 1;
						} else if (targetChange[validArrayIndex1] === 2) {
							var targetSwitch = 2;
						} else if (targetChange[validArrayIndex1] === 3) {
							var targetSwitch = 3;
						} else if (targetChange[validArrayIndex1] === 4) {
							var targetSwitch = 4;
						} else {
							var targetSwitch = 5;
						}
				
						//This is irrelevant for the replication, which doesn't include a pre-cue, but I'm including it again
						//because the tables are already made up in the SQL database.
						var memPos = invalidMemoryPositions[validArrayIndex1];
						var invalidItemIndex = memPos;
						var invalidItem = circleStim[invalidItemIndex];
				
						var memoryStimulus = circleStim[targetPos];
				
						return {invalidTestItem: invalidItem, invalidPosition: memPos, target_position: targetPos, validTrial: validTrial, targetChange: targetSwitch, image0: circleStim[0], image1: circleStim[1], image2: circleStim[2], image3: circleStim[3], image4: circleStim[4], image5: circleStim[5], image6: circleStim[6], image7: circleStim[7], cue_position: cueLocation, memoryStimulus: memoryStimulus  };
				
					}

				};
		
		
				var fixation_block3a = 
				{
					type: "fixation-stim",
					display_element:$('#stimuli-target'),
					fixation_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					fixation_color: 'red',
					timing_fixation: 10,
					timing_post_trial: 0,
					data: function() 
					{
						var data = jsPsych.data.getLastTrialData();
						return {cue_position: data.cue_position, invalidPosition: data.invalidPosition, target_position: data.target_position, validTrial: data.validTrial, targetChange: data.targetChange, cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, image0: data.image0, image1: data.image1, image2: data.image2, image3: data.image3, image4: data.image4, image5: data.image5, image6: data.image6, image7: data.image7, memoryStimulus: data.memoryStimulus}
					}
				};
				
				
				var fixation_block3b = 
				{
					type: "fixation-stim",
					display_element:$('#stimuli-target'),
					fixation_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					fixation_color: 'red',
					timing_fixation: 1000,
					timing_post_trial: 0,
					data: function() 
					{
						var data = jsPsych.data.getLastTrialData();
						return {cue_position: data.cue_position, invalidPosition: data.invalidPosition, target_position: data.target_position, validTrial: data.validTrial, targetChange: data.targetChange, cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, image0: data.image0, image1: data.image1, image2: data.image2, image3: data.image3, image4: data.image4, image5: data.image5, image6: data.image6, image7: data.image7, memoryStimulus: data.memoryStimulus}
					}
				};
				
				var fixation_block3c = 
				{
					type: "fixation-stim",
					display_element:$('#stimuli-target'),
					fixation_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					fixation_color: 'red',
					timing_fixation: 900,
					timing_post_trial: 0,
					data: function() 
					{
						var data = jsPsych.data.getLastTrialData();
						return {cue_position: data.cue_position, invalidPosition: data.invalidPosition, target_position: data.target_position, validTrial: data.validTrial, targetChange: data.targetChange, cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, image0: data.image0, image1: data.image1, image2: data.image2, image3: data.image3, image4: data.image4, image5: data.image5, image6: data.image6, image7: data.image7, memoryStimulus: data.memoryStimulus}
					}
				};
				
		
				//May want to rename to target_position1 and target_position2 in order to know what things are/where they are
				//So that way, when you get to the lineup block, you have control over what you want to call.
				//"If you really wanted to, quadruple_stim doesn't have to be exactly four stimuli."
				var post_stimulus_cue_block = 
				{
					type: "cue-stim",
					display_element: $('#stimuli-target'),
					set_size: images2show,
					cue_position: function()
					{
						//Wanted to use "t" as an index (from the start of the "for" loop), but I don't think that works in jsPsych (I forget why)
						//This form of indexing works, though.  Should ask Josh/Jason about this again, b/c I forgot the details.
						validArrayIndex2 += 1;
						//If the cue is to be invalid, this "if" code needs to run
						//If it's a valid trial, the code in the "else" portion needs to run
						if (imageValid[validArrayIndex2] === 0) {
							//If the cue is invalid, index the invalidMemoryPositions matrix to select the cue position
							//Another way to do this would be to call the previous trial's data, and grab memoryPosition.			
							return invalidMemoryPositions[validArrayIndex2];
						} else { 
							//If it's a valid trial, the test cue position should be the same as initial (memory) cue position.
							return initialCuePositions[validArrayIndex2];
						}
						//Otherwise, if the cue is to be valid, this code needs to run
					},
					cue_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					timing_cue: 500,
					data: function()
					{
						var data = jsPsych.data.getLastTrialData();
						//Note that because the correct target position is carried through in target_position above, this code is OK.
						return {target_position: data.target_position, cuedStim: data.cuedStim, validTrial: data.validTrial, targetChange: data.targetChange, invalidTestItem: data.invalidTestItem, invalidPosition: data.invalidPosition, image0: data.image0, image1: data.image1, image2: data.image2, image3: data.image3, image4: data.image4, image5: data.image5, image6: data.image6, image7: data.image7, memoryStimulus: data.memoryStimulus}
					},
					timing_post_trial: 0
				};
				
				var post_stimulus_cue_blockb = 
				{
					type: "cue4noclear-stim",
					display_element: $('#stimuli-target'),
					set_size: images2show,
					cue_position: function()
					{
						//Wanted to use "t" as an index (from the start of the "for" loop), but I don't think that works in jsPsych (I forget why)
						//This form of indexing works, though.  Should ask Josh/Jason about this again, b/c I forgot the details.
						validArrayIndex2 += 1;
						//If the cue is to be invalid, this "if" code needs to run
						//If it's a valid trial, the code in the "else" portion needs to run
						if (imageValid[validArrayIndex2] === 0) {
							//If the cue is invalid, index the invalidMemoryPositions matrix to select the cue position
							//Another way to do this would be to call the previous trial's data, and grab memoryPosition.			
							return invalidMemoryPositions[validArrayIndex2];
						} else { 
							//If it's a valid trial, the test cue position should be the same as initial (memory) cue position.
							return initialCuePositions[validArrayIndex2];
						}
						//Otherwise, if the cue is to be valid, this code needs to run
					},
					cue_size: cue_size, //
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					timing_cue: 500,
					data: function()
					{
						var data = jsPsych.data.getLastTrialData();
						//Note that because the correct target position is carried through in target_position above, this code is OK.
						return {target_position: data.target_position, cuedStim: data.cuedStim, validTrial: data.validTrial, targetChange: data.targetChange, invalidTestItem: data.invalidTestItem, invalidPosition: data.invalidPosition, image0: data.image0, image1: data.image1, image2: data.image2, image3: data.image3, image4: data.image4, image5: data.image5, image6: data.image6, image7: data.image7, memoryStimulus: data.memoryStimulus}
					},
					timing_post_trial: 0
				};
		
		
				var fixation_block4a = 
				{
					type: "fixation-stim",
					display_element:$('#stimuli-target'),
					fixation_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					fixation_color: 'red',
					timing_fixation: 1490,
					timing_post_trial: 0,
					data: function() 
					{
						var data = jsPsych.data.getLastTrialData();
						return {cue_position: data.cue_position, invalidPosition: data.invalidPosition, target_position: data.target_position, validTrial: data.validTrial, targetChange: data.targetChange, cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, image0: data.image0, image1: data.image1, image2: data.image2, image3: data.image3, image4: data.image4, image5: data.image5, image6: data.image6, image7: data.image7, memoryStimulus: data.memoryStimulus}
					}
				};
				
				
				var fixation_block4b = 
				{
					type: "fixation-stim",
					display_element:$('#stimuli-target'),
					fixation_size: cue_size,
					circle_diameter: circle_diameter,
					target_size: [target_size, target_size],
					fixation_color: 'red',
					timing_fixation: 500,
					timing_post_trial: 0,
					data: function() 
					{
						var data = jsPsych.data.getLastTrialData();
						return {cue_position: data.cue_position, invalidPosition: data.invalidPosition, target_position: data.target_position, validTrial: data.validTrial, targetChange: data.targetChange, cuedStim: data.cuedStim, invalidTestItem: data.invalidTestItem, image0: data.image0, image1: data.image1, image2: data.image2, image3: data.image3, image4: data.image4, image5: data.image5, image6: data.image6, image7: data.image7, memoryStimulus: data.memoryStimulus}
					}
				};
		
		
				var circle_block2 = {
					type: "circle-stim",
					display_element: $('#stimuli-target'),
					stimuli: [function()
					{
						validArrayIndex3 += 1;
						var data = jsPsych.data.getLastTrialData();
						//Draw the same stimuli again in a circle, for starters.
						for (j = 0; j < images2show; j++) {
							circleStim2[j] = imageArray[masterImageArray[j + validArrayIndex3*8]];
						}
						//If it's a change trial, switch the image to something new.  
						//in targetChange, 1's indicate change.  0's indicate no change
						if (targetChange[validArrayIndex3] === 0) {
							newStimIndex = getRandomSubarray(imageArray, 1);
							//I think this should ensure that there aren't any duplicate images on the change trials.
							while (circleStim2.contains(newStimIndex[0])) {
						  	  	newStimIndex = getRandomSubarray(imageArray, 1);
							}
							circleStim2[data.target_position] = newStimIndex[0];
							return circleStim2;
						} else if (targetChange[validArrayIndex3] === 1) {
							newStimIndex = getRandomSubarray(imageArray, 1);
							//I think this should ensure that there aren't any duplicate images on the change trials.
							while (circleStim2.contains(newStimIndex[0])) {
						  	  	newStimIndex = getRandomSubarray(imageArray, 1);
							}
							circleStim2[data.target_position] = newStimIndex[0];
							return circleStim2;
						} else if (targetChange[validArrayIndex3] === 2) {
							newStimIndex = getRandomSubarray(imageArray, 1);
							//I think this should ensure that there aren't any duplicate images on the change trials.
							while (circleStim2.contains(newStimIndex[0])) {
						  	  	newStimIndex = getRandomSubarray(imageArray, 1);
							}
							circleStim2[data.target_position] = newStimIndex[0];
							return circleStim2;
						} else {
						//If it's a no-change trial, kep the image as-is.
							return circleStim2;
						}
					}],
					targetStimPos: function()
					{
						validArrayIndex4 += 1;
						var data = jsPsych.data.getLastTrialData();
				
						if (imageValid[validArrayIndex4] === 1) {
							return data.cue_position;
						} else {
							//THIS NEEDS TO BE changed.  It should call the cue/target position from the memory display.
							//Update: let it go.  I fixed it through another mechanism.
							return data.cue_position;
						}
					},
					target_size: [target_size, target_size],
					circle_diameter: circle_diameter,
					cont_key: 'none',
					timing_max_search: 2000,
					timing_post_trial: 0,
					data: function() 
					{
						var data = jsPsych.data.getLastTrialData();
						return {validTrial: data.validTrial, targetChange: data.targetChange, invalidTestItem: data.invalidTestItem, image0: circleStim2[0], image1: circleStim2[1], image2: circleStim2[2], image3: circleStim2[3], image4: circleStim2[4], image5: circleStim2[5], image6: circleStim2[6], image7: circleStim2[7], cue_position: data.cue_position, invalidPosition: data.invalidPosition, memoryStimulus: data.memoryStimulus, newImage: newStimIndex};
					}
				};		
		
					
					var circle_block3 = {
						type: "circlenoclear-stim",
						display_element: $('#stimuli-target'),
						stimuli: [function()
						{
							validArrayIndex3 += 1;
							var data = jsPsych.data.getLastTrialData();
							//Draw the same stimuli again in a circle, for starters.
							for (j = 0; j < images2show; j++) {
								circleStim3[j] = imageArray[masterImageArray[j + validArrayIndex3*8]];
							}
							//If it's a change trial, switch the image to something new.  
							//in targetChange, 1's indicate change.  0's indicate no change
							if (targetChange[validArrayIndex3] === 0) {
								newStimIndex = getRandomSubarray(imageArray, 1);
								//I think this should ensure that there aren't any duplicate images on the change trials.
								while (circleStim3.contains(newStimIndex[0])) {
							  	  	newStimIndex = getRandomSubarray(imageArray, 1);
								}
								circleStim3[data.target_position] = newStimIndex[0];
								return circleStim3;
							} else if (targetChange[validArrayIndex3] === 1) {
								newStimIndex = getRandomSubarray(imageArray, 1);
								//I think this should ensure that there aren't any duplicate images on the change trials.
								while (circleStim3.contains(newStimIndex[0])) {
							  	  	newStimIndex = getRandomSubarray(imageArray, 1);
								}
								circleStim3[data.target_position] = newStimIndex[0];
								return circleStim3;
							} else if (targetChange[validArrayIndex3] === 2){
								newStimIndex = getRandomSubarray(imageArray, 1);
								//I think this should ensure that there aren't any duplicate images on the change trials.
								while (circleStim3.contains(newStimIndex[0])) {
							  	  	newStimIndex = getRandomSubarray(imageArray, 1);
								}
								circleStim3[data.target_position] = newStimIndex[0];
								return circleStim3;
							} else {
							//If it's a no-change trial, kep the image as-is.
								return circleStim3;
							}
						}],
						targetStimPos: function()
						{
							validArrayIndex4 += 1;
							var data = jsPsych.data.getLastTrialData();
				
							if (imageValid[validArrayIndex4] === 1) {
								return data.cue_position;
							} else {
								//THIS NEEDS TO BE changed.  It should call the cue/target position from the memory display.
								//Update: let it go.  I fixed it through another mechanism.
								return data.cue_position;
							}
						},
						target_size: [target_size, target_size],
						circle_diameter: circle_diameter,
						cont_key: 'none',
						timing_max_search: 100,
						timing_post_trial: 0,
						data: function() 
						{
							var data = jsPsych.data.getLastTrialData();
							return {validTrial: data.validTrial, targetChange: data.targetChange, invalidTestItem: data.invalidTestItem, image0: circleStim2[0], image1: circleStim2[1], image2: circleStim2[2], image3: circleStim2[3], image4: circleStim2[4], image5: circleStim2[5], image6: circleStim2[6], image7: circleStim2[7], cue_position: data.cue_position, invalidPosition: data.invalidPosition, memoryStimulus: data.memoryStimulus, newImage: newStimIndex};
						}
					};		
					
					var circle_block4 = {
						type: "circle-stim",
						display_element: $('#stimuli-target'),
						stimuli: [function(){
								return circleStim3;
						}],
						targetStimPos: function()
						{
							var data = jsPsych.data.getLastTrialData();
							return data.cue_position;
						},
						target_size: [target_size, target_size],
						circle_diameter: circle_diameter,
						cont_key: 'none',
						timing_max_search: 1400,
						timing_post_trial: 0,
						data: function() 
						{
							var data = jsPsych.data.getLastTrialData();
							return {validTrial: data.validTrial, targetChange: data.targetChange, invalidTestItem: data.invalidTestItem, image0: circleStim2[0], image1: circleStim2[1], image2: circleStim2[2], image3: circleStim2[3], image4: circleStim2[4], image5: circleStim2[5], image6: circleStim2[6], image7: circleStim2[7], cue_position: data.cue_position, invalidPosition: data.invalidPosition, memoryStimulus: data.memoryStimulus, newImage: newStimIndex};
						}
					};	
		
		
				//Prompt is a potential input parameter for the lineup block plugin.
				var lineup_block = {
					type: "quadruple-stim",
					stimuli: [function()
					{
						var data = jsPsych.data.getLastTrialData();
						validArrayIndex6 += 1;
				
							//var quadStim = [data.cuedStim];
							quadStim = [data.memoryStimulus];
							//Get only the 41 images you want to sample from.
							//These three lines of code create an array with images from the circle,
							//plus the possible test images
							//NOTE: Using firstImage & secondImage in the following manner was causing 
							//quadStim to show both the 1st and 2nd presentations where the cue occurred in the lineup.
							//Not sure why???  Just getting rid of the secondImage for now.
							var firstImage = data.cuedStim;
							var secondImage = data.invalidTestItem;
							var images4quadStim = circleStim.concat(firstImage,secondImage);
							//Then, compare those 9 images to the 50 possible images.
							var images4quadStimPossible = array4Lineup.diff(images4quadStim);	
							//Then grab 3 of the 41 to use in the lineup.
							var images4quadStim2Use = getRandomSubarray(images4quadStimPossible, 3);
							quadStim.push(images4quadStim2Use[0]);
							quadStim.push(images4quadStim2Use[1]);
							quadStim.push(images4quadStim2Use[2]);
							return quadStim;
					}],
					display_element: $('#stimuli-target'),
					target_size: [target_size, target_size],
					choices: ['1','2','3','4'],
					font_size: 18,
					timing_post_trial: 250,
					prompt: '<center><p>The image at the cue location changed from the 1st to the 2nd presentation!\
					<br>Which image was shown during the 1st presentation at the cued location?\
					<br>Press a number on your keyboard that corresponds to the correct image.</p>',
					data: function() 
					{
						
						var data = jsPsych.data.getLastTrialData();
						return {quadStim1: quadStim[0], quadStim2: quadStim[1], quadStim3: quadStim[2], quadStim4: quadStim[3], targetChange: data.targetChange};
						
					}

				};	
		
		
				//Interleave the end of the practice block, as well as break screens 
				//and catch trials throughout the experiment.
				if (t<(numPracticeTrials)) {
					//Code for the practice trials
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);	
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);	
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
					}
				} else if (t === (numPracticeTrials)) {
					//Code for what to show when the practice trials end.
					experiment.push(practiceEnd);
					experiment.push(instr10);
					experiment.push(instr11);
					experiment.push(instr11a);
					experiment.push(instr11b);
					experiment.push(instr11c);
					experiment.push(instr12);
					
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
			
				} else if (t === 40) {
					//Show the first catch trial (placed at roughly ...)
					experiment.push(fixation_block1);
					experiment.push(fixation_block2);
					experiment.push(stimulusct1);
					experiment.push(catchtrialquestionfinal);
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);	
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
				} else if (t === 45) {
					//Show a break screen!
					experiment.push(takeBreak);
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
			
				} else if (t === 75) {
					//Show the second catch trial (placed at roughly ...)
					experiment.push(fixation_block1);
					experiment.push(fixation_block2);
					experiment.push(stimulusct2);
					experiment.push(catchtrialquestionfinal);
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
				} else if (t === 90) {
					//Show a break screen!
					experiment.push(takeBreak);
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
			
				} else if (t === 120) {
					//Show the third catch trial (placed at roughly ...)
					experiment.push(fixation_block1);
					experiment.push(fixation_block2);
					experiment.push(stimulusct3);
					experiment.push(catchtrialquestionfinal);
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
				} else if (t === 140) {
					//Show a break screen!
					experiment.push(takeBreak);
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
			
				} else if (t === 170) {
					//Show the fourth catch trial (placed at roughly ...)
					experiment.push(fixation_block1);
					experiment.push(fixation_block2);
					experiment.push(stimulusct4);
					experiment.push(catchtrialquestionfinal);
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);	
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
				} else if (t === (numTrials-1)) {
					//Code for the last trial of the experiment!
					//We want to show the photo questions right at the end.
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
			
					//These are the lines of code that will end the experiment by asking about photos.
					experiment.push(photoInstructions);
					experiment.push(ka_photos);
					experiment.push(cohen2016_fig1);
					experiment.push(cohen2016_fig3);
				} else {
					//What to do for the rest of the trials in the experiment
					//There are six trial types.  The code below specifies what to do depending on whether
					//it's iconic/fragile/working memory that you want to assess, and whether the target
					//changes on that particular trial
					//See lab notebook entry on 08-15-16 for what the conditions mean
					
					if (targetChange[t] === 0) {
						//This is what should happen on an iconic memory CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);			
					} else if (targetChange[t] === 1) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);		
					} else if (targetChange[t] === 2) {
						//THIS IS WRONG.  CHANGE IT TO THE POST-STIMULUS CONDITION LATER ON.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
						experiment.push(lineup_block);
						experiment.push(confidenceQuestionDiscrimination);
						experiment.push(compareDiscrimination);	
					} else if (targetChange[t] === 3) {
						//This is what should happen on an iconic memory NO CHANGE trial
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3a);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4a);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 4) {
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3b);
						experiment.push(post_stimulus_cue_block);
						experiment.push(fixation_block4b);
						experiment.push(circle_block2);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					} else if (targetChange[t] === 5) {
						//THIS CODE BELOW IS WRONG.  NEEDS TO BE RE-CODED TO ASSESS WORKING MEMORY.
						experiment.push(fixation_block1);
						experiment.push(fixation_block2);
						experiment.push(circle_block1);
						experiment.push(fixation_block3c);
						experiment.push(circle_block3);
						experiment.push(post_stimulus_cue_blockb);
						experiment.push(circle_block4);
						experiment.push(detectionQuestion);
						experiment.push(confidenceQuestionDetection);
						experiment.push(compareDetection);
					}
				}
		
				//THIS IS THE LINE OF CODE TO USE IF YOU WANT TO ASK ABOUT DISCRIMINATION.
				//experiment.push(lineup_block);
				//experiment.push(confidenceQuestion);
		
			}//This ends the for loop that builds the order/trials for the experiment.
	
			//Preload the images.  Based on the recommendation in the jsPsych documentation.
			//NOTE: This doesn't actually seem to do the job.  I had to show all of the images
			//once during the instruction to get rid of lag/glitchy timing issues.
			//jsPsych.preloadImages(imageArray, function(){ startExperiment(); });
	
		    //function startExperiment()
				jsPsych.init({
				  show_progress_bar: true,
		      	  experiment_structure: experiment,
			  	  display_element: $('#jspsych-target'),
		 		  on_trial_finish: function() {
					 //save_data('sligteReplication', [jsPsych.data.getLastTrialData()]);
					 //console.log(jsPsych.data.getLastTrialData());	
		 		  },
			      on_finish: function() {
					 //jsPsych.data.localSave(filename, 'csv');
					 //psiturk.saveData({
			       	 //	success: function() { psiturk.completeHIT(); }
			   	   	 //});
				  }
		    	});
			}
    </script>
</html>